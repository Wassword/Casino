<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGC 21 or Bust!</title>
    <link rel="icon" type="image/png" th:href="@{/images/grin.png}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script>
        function hit() {
            fetch('/blackjack/hit', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('status').innerText = data.status;
                    document.getElementById('statusS').innerText = data.statusS;

                    // Update player's hand images
                    const playerHandContainer = document.getElementById('playerHandImages');
                    playerHandContainer.innerHTML = '';
                    data.playerHandImages.forEach(imagePath => {
                        const img = document.createElement('img');
                        img.src = imagePath;
                        img.alt = 'Player Card';
                        img.classList.add('card-image');
                        playerHandContainer.appendChild(img);
                    });

                    // Update dealer's face-up card image
                    const dealerFaceUpCard = document.getElementById('dealerFaceUpCard');
                    dealerFaceUpCard.src = data.dealerFaceUpCard;

                    // If game is over, display final message and disable buttons
                    if (data.gameOver) {
                        window.location.href = 'blackjack/results';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Unexpected error occurred. Please try again.');
                });
        }
    </script>
</head>
<body>
<div class="container">
    <h1>21 or BUST!</h1>

    <!-- Display game status -->
    <p id="status" th:text="${statusS}"></p>

    <!-- Dealer's Hand -->
    <h2>Dealer's Hand</h2>
    <div class="hand">
        <img id="dealerFaceUpCard" th:src="${dealerFaceUpCard}" alt="Dealer's Face-Up Card" class="card-image">
        <img th:src="@{/images/Playing-Cards/CardBackFaceBlueSmallPattern.png}" alt="Hidden Card" class="card-image">
    </div>

    <!-- Player's Hand -->
    <h2>Your Hand</h2>
    <div id="playerHandImages" class="hand">
        <!-- Player hand cards will be dynamically populated by JavaScript -->
        <div th:each="card : ${playerHandImages}">
            <img th:src="${card}" alt="Player Card" class="card-image">
        </div>
    </div>


    <!-- Result Message (only shown if the game is over) -->
    <p id="resultMessage" style="font-weight: bold;"></p>

    <!-- Player Actions -->
    <div class="action-buttons">
        <button id="hitButton" type="button" class="btn btn-primary" onclick="hit()">Hit</button>
        <form method="post" action="/blackjack/stand" style="display: inline;">
            <button id="standButton" type="submit" class="btn btn-warning">Stand</button>
        </form>
        <button id="doubleDownButton" class="btn btn-success" onclick="doubleDown()">Double Down</button>
    </div>
</div>

<script>
    // JavaScript function for double down action
    function doubleDown() {
        fetch('/blackjack/double-down', {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('statusMessage').innerText = data.status;

                // Update player and dealer hands in the UI
                const playerHand = document.getElementById('playerHand');
                playerHand.innerHTML = '';
                data.playerHandImages.forEach(card => {
                    const cardElement = document.createElement('img');
                    cardElement.src = card;
                    cardElement.className = 'card-image';
                    playerHand.appendChild(cardElement);
                });
<<<<<<< Updated upstream
                //
                // const dealerHand = document.getElementById('dealerHand');
                // dealerHand.innerHTML = '';
                // const dealerCardElement = document.createElement('img');
                // dealerCardElement.src = data.dealerFaceUpCard;
                // dealerCardElement.className = 'card-image';
                // dealerHand.appendChild(dealerCardElement);

                if (data.gameOver) {
                    window.location.href = 'blackjack/results';
=======

                if (data.gameOver) {
                    window.location.href = 'blackjack/results';

>>>>>>> Stashed changes
                }
            })
            .catch(error => {
                console.error('Error with double down:', error);
                document.getElementById('statusMessage').innerText = 'An error occurred. Please try again.';
            });
    }
</script>
</body>
</html>
